<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kuyu.mapper.pcms.PcmsPaymentMapper">
  <resultMap id="BaseResultMap" type="com.kuyu.model.pcms.PcmsPayment">
    <id column="pmid" jdbcType="INTEGER" property="pmid" />
    <result column="company_code" jdbcType="VARCHAR" property="companyCode" />
    <result column="request_dept" jdbcType="VARCHAR" property="requestDept" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="fssc_bill" jdbcType="VARCHAR" property="fsscBill" />
    <result column="vendor_id" jdbcType="VARCHAR" property="vendorId" />
    <result column="account_number" jdbcType="VARCHAR" property="accountNumber" />
    <result column="account_name" jdbcType="VARCHAR" property="accountName" />
    <result column="payee_name" jdbcType="VARCHAR" property="payeeName" />
    <result column="payment_type" jdbcType="VARCHAR" property="paymentType" />
    <result column="recomment_date" jdbcType="VARCHAR" property="recommentDate" />
    <result column="pay_amount" jdbcType="VARCHAR" property="payAmount" />
    <result column="pay_standard" jdbcType="VARCHAR" property="payStandard" />
    <result column="bill_expire_date" jdbcType="VARCHAR" property="billExpireDate" />
    <result column="bank_account_number" jdbcType="VARCHAR" property="bankAccountNumber" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="stop_reason" jdbcType="VARCHAR" property="stopReason" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    pmid, company_code, request_dept, type, fssc_bill, vendor_id, account_number, account_name, 
    payee_name, payment_type, recomment_date, pay_amount, pay_standard, bill_expire_date, 
    bank_account_number, status, stop_reason, create_time, update_time
  </sql>
  <select id="selectByExample" parameterType="com.kuyu.model.pcms.PcmsPaymentExample" resultMap="BaseResultMap">
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from pcms_payment
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from pcms_payment
    where pmid = #{pmid,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from pcms_payment
    where pmid = #{pmid,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.kuyu.model.pcms.PcmsPaymentExample">
    delete from pcms_payment
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.kuyu.model.pcms.PcmsPayment">
    insert into pcms_payment (pmid, company_code, request_dept, 
      type, fssc_bill, vendor_id, 
      account_number, account_name, payee_name, 
      payment_type, recomment_date, pay_amount, 
      pay_standard, bill_expire_date, bank_account_number, 
      status, stop_reason, create_time, 
      update_time)
    values (#{pmid,jdbcType=INTEGER}, #{companyCode,jdbcType=VARCHAR}, #{requestDept,jdbcType=VARCHAR}, 
      #{type,jdbcType=INTEGER}, #{fsscBill,jdbcType=VARCHAR}, #{vendorId,jdbcType=VARCHAR}, 
      #{accountNumber,jdbcType=VARCHAR}, #{accountName,jdbcType=VARCHAR}, #{payeeName,jdbcType=VARCHAR}, 
      #{paymentType,jdbcType=VARCHAR}, #{recommentDate,jdbcType=VARCHAR}, #{payAmount,jdbcType=VARCHAR}, 
      #{payStandard,jdbcType=VARCHAR}, #{billExpireDate,jdbcType=VARCHAR}, #{bankAccountNumber,jdbcType=VARCHAR}, 
      #{status,jdbcType=INTEGER}, #{stopReason,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, 
      #{updateTime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.kuyu.model.pcms.PcmsPayment">
    insert into pcms_payment
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="pmid != null">
        pmid,
      </if>
      <if test="companyCode != null">
        company_code,
      </if>
      <if test="requestDept != null">
        request_dept,
      </if>
      <if test="type != null">
        type,
      </if>
      <if test="fsscBill != null">
        fssc_bill,
      </if>
      <if test="vendorId != null">
        vendor_id,
      </if>
      <if test="accountNumber != null">
        account_number,
      </if>
      <if test="accountName != null">
        account_name,
      </if>
      <if test="payeeName != null">
        payee_name,
      </if>
      <if test="paymentType != null">
        payment_type,
      </if>
      <if test="recommentDate != null">
        recomment_date,
      </if>
      <if test="payAmount != null">
        pay_amount,
      </if>
      <if test="payStandard != null">
        pay_standard,
      </if>
      <if test="billExpireDate != null">
        bill_expire_date,
      </if>
      <if test="bankAccountNumber != null">
        bank_account_number,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="stopReason != null">
        stop_reason,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="pmid != null">
        #{pmid,jdbcType=INTEGER},
      </if>
      <if test="companyCode != null">
        #{companyCode,jdbcType=VARCHAR},
      </if>
      <if test="requestDept != null">
        #{requestDept,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        #{type,jdbcType=INTEGER},
      </if>
      <if test="fsscBill != null">
        #{fsscBill,jdbcType=VARCHAR},
      </if>
      <if test="vendorId != null">
        #{vendorId,jdbcType=VARCHAR},
      </if>
      <if test="accountNumber != null">
        #{accountNumber,jdbcType=VARCHAR},
      </if>
      <if test="accountName != null">
        #{accountName,jdbcType=VARCHAR},
      </if>
      <if test="payeeName != null">
        #{payeeName,jdbcType=VARCHAR},
      </if>
      <if test="paymentType != null">
        #{paymentType,jdbcType=VARCHAR},
      </if>
      <if test="recommentDate != null">
        #{recommentDate,jdbcType=VARCHAR},
      </if>
      <if test="payAmount != null">
        #{payAmount,jdbcType=VARCHAR},
      </if>
      <if test="payStandard != null">
        #{payStandard,jdbcType=VARCHAR},
      </if>
      <if test="billExpireDate != null">
        #{billExpireDate,jdbcType=VARCHAR},
      </if>
      <if test="bankAccountNumber != null">
        #{bankAccountNumber,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="stopReason != null">
        #{stopReason,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.kuyu.model.pcms.PcmsPaymentExample" resultType="java.lang.Integer">
    select count(*) from pcms_payment
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    update pcms_payment
    <set>
      <if test="record.pmid != null">
        pmid = #{record.pmid,jdbcType=INTEGER},
      </if>
      <if test="record.companyCode != null">
        company_code = #{record.companyCode,jdbcType=VARCHAR},
      </if>
      <if test="record.requestDept != null">
        request_dept = #{record.requestDept,jdbcType=VARCHAR},
      </if>
      <if test="record.type != null">
        type = #{record.type,jdbcType=INTEGER},
      </if>
      <if test="record.fsscBill != null">
        fssc_bill = #{record.fsscBill,jdbcType=VARCHAR},
      </if>
      <if test="record.vendorId != null">
        vendor_id = #{record.vendorId,jdbcType=VARCHAR},
      </if>
      <if test="record.accountNumber != null">
        account_number = #{record.accountNumber,jdbcType=VARCHAR},
      </if>
      <if test="record.accountName != null">
        account_name = #{record.accountName,jdbcType=VARCHAR},
      </if>
      <if test="record.payeeName != null">
        payee_name = #{record.payeeName,jdbcType=VARCHAR},
      </if>
      <if test="record.paymentType != null">
        payment_type = #{record.paymentType,jdbcType=VARCHAR},
      </if>
      <if test="record.recommentDate != null">
        recomment_date = #{record.recommentDate,jdbcType=VARCHAR},
      </if>
      <if test="record.payAmount != null">
        pay_amount = #{record.payAmount,jdbcType=VARCHAR},
      </if>
      <if test="record.payStandard != null">
        pay_standard = #{record.payStandard,jdbcType=VARCHAR},
      </if>
      <if test="record.billExpireDate != null">
        bill_expire_date = #{record.billExpireDate,jdbcType=VARCHAR},
      </if>
      <if test="record.bankAccountNumber != null">
        bank_account_number = #{record.bankAccountNumber,jdbcType=VARCHAR},
      </if>
      <if test="record.status != null">
        status = #{record.status,jdbcType=INTEGER},
      </if>
      <if test="record.stopReason != null">
        stop_reason = #{record.stopReason,jdbcType=VARCHAR},
      </if>
      <if test="record.createTime != null">
        create_time = #{record.createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.updateTime != null">
        update_time = #{record.updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    update pcms_payment
    set pmid = #{record.pmid,jdbcType=INTEGER},
      company_code = #{record.companyCode,jdbcType=VARCHAR},
      request_dept = #{record.requestDept,jdbcType=VARCHAR},
      type = #{record.type,jdbcType=INTEGER},
      fssc_bill = #{record.fsscBill,jdbcType=VARCHAR},
      vendor_id = #{record.vendorId,jdbcType=VARCHAR},
      account_number = #{record.accountNumber,jdbcType=VARCHAR},
      account_name = #{record.accountName,jdbcType=VARCHAR},
      payee_name = #{record.payeeName,jdbcType=VARCHAR},
      payment_type = #{record.paymentType,jdbcType=VARCHAR},
      recomment_date = #{record.recommentDate,jdbcType=VARCHAR},
      pay_amount = #{record.payAmount,jdbcType=VARCHAR},
      pay_standard = #{record.payStandard,jdbcType=VARCHAR},
      bill_expire_date = #{record.billExpireDate,jdbcType=VARCHAR},
      bank_account_number = #{record.bankAccountNumber,jdbcType=VARCHAR},
      status = #{record.status,jdbcType=INTEGER},
      stop_reason = #{record.stopReason,jdbcType=VARCHAR},
      create_time = #{record.createTime,jdbcType=TIMESTAMP},
      update_time = #{record.updateTime,jdbcType=TIMESTAMP}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.kuyu.model.pcms.PcmsPayment">
    update pcms_payment
    <set>
      <if test="companyCode != null">
        company_code = #{companyCode,jdbcType=VARCHAR},
      </if>
      <if test="requestDept != null">
        request_dept = #{requestDept,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        type = #{type,jdbcType=INTEGER},
      </if>
      <if test="fsscBill != null">
        fssc_bill = #{fsscBill,jdbcType=VARCHAR},
      </if>
      <if test="vendorId != null">
        vendor_id = #{vendorId,jdbcType=VARCHAR},
      </if>
      <if test="accountNumber != null">
        account_number = #{accountNumber,jdbcType=VARCHAR},
      </if>
      <if test="accountName != null">
        account_name = #{accountName,jdbcType=VARCHAR},
      </if>
      <if test="payeeName != null">
        payee_name = #{payeeName,jdbcType=VARCHAR},
      </if>
      <if test="paymentType != null">
        payment_type = #{paymentType,jdbcType=VARCHAR},
      </if>
      <if test="recommentDate != null">
        recomment_date = #{recommentDate,jdbcType=VARCHAR},
      </if>
      <if test="payAmount != null">
        pay_amount = #{payAmount,jdbcType=VARCHAR},
      </if>
      <if test="payStandard != null">
        pay_standard = #{payStandard,jdbcType=VARCHAR},
      </if>
      <if test="billExpireDate != null">
        bill_expire_date = #{billExpireDate,jdbcType=VARCHAR},
      </if>
      <if test="bankAccountNumber != null">
        bank_account_number = #{bankAccountNumber,jdbcType=VARCHAR},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="stopReason != null">
        stop_reason = #{stopReason,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where pmid = #{pmid,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.kuyu.model.pcms.PcmsPayment">
    update pcms_payment
    set company_code = #{companyCode,jdbcType=VARCHAR},
      request_dept = #{requestDept,jdbcType=VARCHAR},
      type = #{type,jdbcType=INTEGER},
      fssc_bill = #{fsscBill,jdbcType=VARCHAR},
      vendor_id = #{vendorId,jdbcType=VARCHAR},
      account_number = #{accountNumber,jdbcType=VARCHAR},
      account_name = #{accountName,jdbcType=VARCHAR},
      payee_name = #{payeeName,jdbcType=VARCHAR},
      payment_type = #{paymentType,jdbcType=VARCHAR},
      recomment_date = #{recommentDate,jdbcType=VARCHAR},
      pay_amount = #{payAmount,jdbcType=VARCHAR},
      pay_standard = #{payStandard,jdbcType=VARCHAR},
      bill_expire_date = #{billExpireDate,jdbcType=VARCHAR},
      bank_account_number = #{bankAccountNumber,jdbcType=VARCHAR},
      status = #{status,jdbcType=INTEGER},
      stop_reason = #{stopReason,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where pmid = #{pmid,jdbcType=INTEGER}
  </update>
  
  
  
  
  <!-- ==============================自定义SQL=================================== -->
  <select id="getPaymentList" parameterType="map" resultType="com.kuyu.vo.pcms.PaymentResult">
  SELECT
	a.pmid,
	a.fssc_bill AS fsscBill,
	a.vendor_id AS vendorId,
	IFNULL(b.vendor_name,a.vendor_id) AS vendorName,
	a.payment_type AS paymentType,
	a.pay_amount AS payAmount,
	a.account_name AS accountName,
	a.account_number AS accountNumber,
	a.payee_name AS payeeName,
	a.`status` AS payStatus,
	a.update_time AS updateTime
FROM
	pcms_payment a 
LEFT JOIN pcms_supplier b ON a.vendor_id=b.vendor_id
WHERE 1=1 
<if test="companyCode != null">
        AND a.company_code=#{companyCode}
</if>
<if test="searchKey != null">
  	AND (
		b.vendor_name LIKE #{searchKey}
		OR a.fssc_bill LIKE #{searchKey}
		)
</if>
<if test="approvalStatrTime != null">
  		AND DATE_FORMAT(a.create_time,'%Y-%m-%d') BETWEEN #{approvalStatrTime} AND #{approvalEndTime}
</if>
<if test="status != null">
  		AND a.`status`=#{status}
 </if>		
 ORDER BY a.create_time DESC 
  limit #{linimt}, #{size}
  </select>
  
   <select id="getPaymentListCount" parameterType="map" resultType="int">
	 SELECT
		COUNT(*)
	FROM
		pcms_payment a 
	LEFT JOIN pcms_supplier b ON a.vendor_id=b.vendor_id
	WHERE 1=1 
<if test="companyCode != null">
        AND a.company_code=#{companyCode}
</if>
<if test="searchKey != null">
  	AND (
		b.vendor_name LIKE #{searchKey}
		OR a.fssc_bill LIKE #{searchKey}
		)
</if>
<if test="approvalStatrTime != null">
  		AND DATE_FORMAT(a.create_time,'%Y-%m-%d') BETWEEN #{approvalStatrTime} AND #{approvalEndTime}
</if>	
<if test="status != null">
  		AND a.`status`=#{status}
 </if>
  </select> 
  
  
   <select id="getDetailMoney" parameterType="string" resultType="com.kuyu.vo.pcms.PaymentResult">
   	SELECT
	sum(
		CASE
		WHEN a.financial_status =8 THEN
			a.financial_money
		ELSE
			0
		END
	) AS   alreadyAmount,
	sum(
		CASE
		WHEN a.financial_status =-1 THEN
				a.financial_money
		ELSE
			0
		END
	) AS stopAmount,
	sum(
		CASE
		WHEN a.financial_status =9 THEN
				a.financial_money
		ELSE
			0
		END
	) AS failAmount
FROM
pcms_payment_detail a WHERE a.fssc_bill=#{fsscBill}
   
   </select>
  
  
  <select id="selectByFsscBill" parameterType="string" resultMap="BaseResultMap">
	SELECT
		*
	FROM
		pcms_payment
	WHERE
		fssc_bill =#{fsscBill}
  </select>
  
</mapper>